<!DOCTYPE html>
<html lang="zh-Hans">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>老房翻新全流程指南</title>
    <!-- 添加html2pdf库用于PDF导出 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <!-- 添加Font Awesome图标库 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- 引入外部CSS文件 -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <div class="container">
            <h1>老房翻新全流程指南</h1>
            <p class="subtitle">从砸墙到软装，一站式掌握家装翻新的每一个环节和时间规划</p>
        </div>
    </header>

    <div class="container">
        <div class="intro">
            <h2>老房翻新：让旧居焕发新生</h2>
            <p>老房翻新是一项系统工程，需要合理规划各个环节，把握施工顺序和工期安排。本指南将为您详细介绍从前期准备到最终软装的全过程，帮助您高效、顺利地完成家装翻新。</p>
        </div>

        <div class="control-panel">
            <h3>装修流程定制</h3>
            <div class="control-buttons">
                <button class="control-btn add-timeline-btn" onclick="openAddModal()">
                    <i class="fas fa-plus"></i> 添加新阶段
                </button>
                <button class="control-btn export-pdf-btn" onclick="exportToPDF()">
                    <i class="fas fa-file-pdf"></i> 导出为PDF
                </button>
            </div>
        </div>

        <div class="timeline">
            <!-- 阶段1：前期准备 -->
            <div class="timeline-item" data-id="1">
                <div class="timeline-dot">1</div>
                <div class="timeline-content">
                    <div class="edit-buttons">
                        <button class="edit-btn" onclick="editTimelineItem(1)"><i class="fas fa-edit"></i></button>
                        <button class="delete-btn" onclick="deleteTimelineItem(1)"><i class="fas fa-trash"></i></button>
                    </div>
                    <div class="timeline-title">
                        <h3>前期准备</h3>
                        <span class="timeline-duration">2-4周</span>
                    </div>
                    <div class="timeline-description">
                        <p>在正式开始施工前，需要进行充分的准备工作，包括设计方案确定、预算规划、材料选购等。</p>
                    </div>
                    <div class="timeline-tips">
                        <div class="collapsible-header">
                            <h4>要点提示</h4>
                            <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
                        </div>
                        <div class="collapsible-content">
                            <ul>
                                <li>测量房屋尺寸，绘制原始建筑图</li>
                                <li>确定装修风格和功能需求</li>
                                <li>确定设计意向</li>
                                <li>确定立面模型、效果图</li>
                                <li>确定墙体拆除图、新建墙体图等施工图</li>
                                <li>选择装修公司或独立工人团队</li>
                                <li>联系<strong>燃气公司</strong>拆卸燃气表</li>
                                <li>如果<strong>入户门</strong>需要更换，则需要进行入户门洞量尺</li>
                                <li>如果<strong>窗户</strong>需要更换，则需要进行窗户量尺（参见<a href="window_design.html">注意事项</a>)
                                    <ul>
                                        <li>旧窗户不建议拆除太早，不然墙体裸露在外，碰上下雨容易造成外墙漏水</li>
                                    </ul>
                                </li>
                                <li>如果有<strong>暖气</strong>且要更换，需要进行量尺</li>
                                <li>如果墙体有<strong>内保温</strong>，确定是否需要拆除，会影响预算</li>
                                <li>最好确定<strong>地砖</strong>和<strong>墙砖</strong>的尺寸，对瓦工预算影响较大</li>
                                <li><strong>铝扣板吊顶</strong>测量</li>
                                <li>地砖上墙要⽤<strong>瓷砖胶</strong>才能贴牢，问清楚瓷砖胶由谁买，什么品牌，怎么收费</li>
                                <li>制定详细预算</li>
                                <li>选择<strong>第三方监理</strong></li>
                                <li><strong>物业</strong>办理装修许可
                                </li>
                                <li>确认水、地漏是否畅通，管道是否正常，避免因为房屋问题出现扯皮现象</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 阶段2：拆除与新建墙体 -->
            <div class="timeline-item" data-id="2">
                <div class="timeline-dot">2</div>
                <div class="timeline-content">
                    <div class="edit-buttons">
                        <button class="edit-btn" onclick="editTimelineItem(2)"><i class="fas fa-edit"></i></button>
                        <button class="delete-btn" onclick="deleteTimelineItem(2)"><i class="fas fa-trash"></i></button>
                    </div>
                    <div class="timeline-title">
                        <h3>拆除与新建墙体</h3>
                        <span class="timeline-duration">5-10天</span>
                    </div>
                    <div class="timeline-description">
                        <p>拆除是老房翻新的第一步实际施工，包括铲墙、拆墙、砸地、拆旧设施等。同时，根据新的户型设计进行墙体新建工作。</p>
                    </div>
                    <div class="timeline-tips">
                        <div class="collapsible-header">
                            <h4>要点提示</h4>
                            <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
                        </div>
                        <div class="collapsible-content">
                            <ul>
                                <li>铲墙和砸地之前要确认铲几层，价格包含几层的价格</li>
                                <li>确认承重墙位置，非承重墙才可拆除</li>
                                <li>断水断电，确保施工安全</li>
                                <li>保护楼梯、电梯等公共区域</li>
                                <li>垃圾及时清运，避免堆积</li>
                                <li>拆除时注意保护保留的结构和设施</li>
                                <li>新建墙体使用轻体砖，减轻楼板负担</li>
                                <li>新建墙体需要挂网，防止开裂</li>
                                <li>新建墙体需确保垂直度和平整度</li>
                                <li>包立管</li>
                                <li>预留好门窗洞口和管线穿墙位置</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 阶段3：水电改造 -->
            <div class="timeline-item" data-id="3">
                <div class="timeline-dot">3</div>
                <div class="timeline-content">
                    <div class="edit-buttons">
                        <button class="edit-btn" onclick="editTimelineItem(3)"><i class="fas fa-edit"></i></button>
                        <button class="delete-btn" onclick="deleteTimelineItem(3)"><i class="fas fa-trash"></i></button>
                    </div>
                    <div class="timeline-title">
                        <h3>水电改造</h3>
                        <span class="timeline-duration">7-14天</span>
                    </div>
                    <div class="timeline-description">
                        <p>水电改造是隐蔽工程，需要在墙体和地面封闭前完成，包括水管、电线的更换和重新布局。</p>
                    </div>
                    <div class="timeline-tips">
                        <div class="collapsible-header">
                            <h4>要点提示</h4>
                            <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
                        </div>
                        <div class="collapsible-content">
                            <ul>
                                <li>水电交底时约燃气公司对接改<strong>燃气</strong>方案，贴砖前改管</li>
                                <li>如果有<strong>暖气</strong>，需要提前和暖气公司沟通，完成改管</li>
                                <li><strong>燃气热水器</strong>测量，确定安装区域、燃气表位置、排烟管走向等</li>
                                <li>需购买强电箱、空气开关</li>
                                <li>根据家具和电器布局规划<strong>插座</strong>、<strong>开关</strong>、<strong>灯具</strong>和<strong>上下水</strong>位置</li>
                                <li>如果安装壁挂马桶，水电阶段安装水箱</li>
                                <li>如果有暗藏龙头、花洒，水电阶段预埋暗藏件</li>
                                <li>更换老旧水管，避免日后漏水</li>
                                <li>水电改造完成后进行测试</li>
                                <li>拍照记录水电线路位置，方便日后维修</li>
                                <li>可进行<strong>新风系统</strong>、<strong>中央空调</strong>、<strong>入户门</strong>安装</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 阶段4：外门窗安装 -->
            <div class="timeline-item" data-id="4">
                <div class="timeline-dot">4</div>
                <div class="timeline-content">
                    <div class="edit-buttons">
                        <button class="edit-btn" onclick="editTimelineItem(4)"><i class="fas fa-edit"></i></button>
                        <button class="delete-btn" onclick="deleteTimelineItem(4)"><i class="fas fa-trash"></i></button>
                    </div>
                    <div class="timeline-title">
                        <h3>外门窗安装</h3>
                        <span class="timeline-duration">1天</span>
                    </div>
                    <div class="timeline-description">
                        <p>在水电改造完成后，进行外门窗的拆除和安装。</p>
                    </div>
                    <div class="timeline-tips">
                        <div class="collapsible-header">
                            <h4>要点提示</h4>
                            <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
                        </div>
                        <div class="collapsible-content">
                            <ul>
                                <li>确保门窗安装牢固、密封良好</li>
                                <li>注意门窗开启方向的合理性</li>
                                <li>安装后检查门窗的开关是否顺畅</li>
                                <li>做好门窗周边的防水处理</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 阶段5：瓦工阶段 -->
            <div class="timeline-item" data-id="5">
                <div class="timeline-dot">5</div>
                <div class="timeline-content">
                    <div class="edit-buttons">
                        <button class="edit-btn" onclick="editTimelineItem(5)"><i class="fas fa-edit"></i></button>
                        <button class="delete-btn" onclick="deleteTimelineItem(5)"><i class="fas fa-trash"></i></button>
                    </div>
                    <div class="timeline-title">
                        <h3>瓦工阶段</h3>
                        <span class="timeline-duration">10-15天</span>
                    </div>
                    <div class="timeline-description">
                        <p>瓦工阶段包括贴砖等工作，是房屋基础结构的重建过程。</p>
                    </div>
                    <div class="timeline-tips">
                        <div class="collapsible-header">
                            <h4>要点提示</h4>
                            <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
                        </div>
                        <div class="collapsible-content">
                            <ul>
                                <li><strong>金属门</strong>、<strong>木门</strong>和<strong>橱柜</strong>的复尺</li>
                                <li>厨房和卫生间的防水必不可少</li>
                                <li>防水层完成后需做48小时闭水试验</li>
                                <li>地砖铺贴需考虑排水坡度</li>
                                <li>墙砖铺贴需检查垂直度</li>
                                <li>墻⾯贴瓷砖，要先在墻⾯上<strong>拉⽑</strong>才能增强和瓷砖的摩擦力</li>
                                <li>「墙压地」相对于「地压墙」更美观、协调</li>
                                <li><strong>地漏</strong>和地砖共同配合安装</li>
                                <li>过门石、大理石窗台的安装</li>
                                <li>贴完砖后进行<strong>室内门测量</strong>、<strong>燃气改管</strong></li>
                                <li>贴完砖7-15天就可以进行美缝</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 阶段5：木工阶段 -->
            <div class="timeline-item" data-id="6">
                <div class="timeline-dot">6</div>
                <div class="timeline-content">
                    <div class="edit-buttons">
                        <button class="edit-btn" onclick="editTimelineItem(6)"><i class="fas fa-edit"></i></button>
                        <button class="delete-btn" onclick="deleteTimelineItem(6)"><i class="fas fa-trash"></i></button>
                    </div>
                    <div class="timeline-title">
                        <h3>木工吊顶</h3>
                        <span class="timeline-duration">3-5天</span>
                    </div>
                    <div class="timeline-description">
                        <p>木工吊顶的制作和安装。</p>
                    </div>
                    <div class="timeline-tips">
                        <div class="collapsible-header">
                            <h4>要点提示</h4>
                            <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
                        </div>
                        <div class="collapsible-content">
                            <ul>
                                <li>轨道灯、线型灯槽送货</li>
                                <li>预留空调、排风等设备位置</li>
                                <li>钉眼要刷防锈漆</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 阶段6：油漆工程 -->
            <div class="timeline-item" data-id="7">
                <div class="timeline-dot">7</div>
                <div class="timeline-content">
                    <div class="edit-buttons">
                        <button class="edit-btn" onclick="editTimelineItem(7)"><i class="fas fa-edit"></i></button>
                        <button class="delete-btn" onclick="deleteTimelineItem(7)"><i class="fas fa-trash"></i></button>
                    </div>
                    <div class="timeline-title">
                        <h3>油漆工程与厨卫吊顶</h3>
                        <span class="timeline-duration">10-15天</span>
                    </div>
                    <div class="timeline-description">
                        <p>油漆工程包括刷底漆和面漆等。同时进行厨房和卫生间的铝扣板吊顶、浴霸、吸顶灯、止逆阀和热水器的安装。</p>
                    </div>
                    <div class="timeline-tips">
                        <div class="collapsible-header">
                            <h4>要点提示</h4>
                            <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
                        </div>
                        <div class="collapsible-content">
                            <ul>
                                <li>这个阶段可以打<strong>空调孔</strong></li>
                                <li>如果有<strong>弧形阳角</strong>，提前说</li>
                                <li>选择环保低VOC油漆</li>
                                <li>墙面需充分干燥后才能上漆</li>
                                <li>每道工序间需留足干燥时间</li>
                                <li>施工期间保持通风</li>
                                <li>做好成品保护，避免污染</li>
                                <li>如有<strong>室内窗</strong>，刮腻子刷漆之后测量</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 阶段7：安装阶段 -->
            <div class="timeline-item" data-id="8">
                <div class="timeline-dot">8</div>
                <div class="timeline-content">
                    <div class="edit-buttons">
                        <button class="edit-btn" onclick="editTimelineItem(8)"><i class="fas fa-edit"></i></button>
                        <button class="delete-btn" onclick="deleteTimelineItem(8)"><i class="fas fa-trash"></i></button>
                    </div>
                    <div class="timeline-title">
                        <h3>安装阶段</h3>
                        <span class="timeline-duration">5-10天</span>
                    </div>
                    <div class="timeline-description">
                        <p>安装阶段包括分体式空调、橱柜、水龙头、水槽、内门、地板、烟机、灶具、燃气热水器、散热器、开关插座、灯具、卫浴设备等的安装。</p>
                    </div>
                    <div class="timeline-tips">
                        <div class="collapsible-header">
                            <h4>要点提示</h4>
                            <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
                        </div>
                        <div class="collapsible-content">
                            <ul>
                                <li>地板安装前需检查地面平整度</li>
                                <li>内门安装需确保开关顺畅</li>
                                <li>卫浴设备安装后检查是否漏水</li>
                                <li>灯具安装需确认电路正常</li>
                                <li>各类设备安装后进行功能测试</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 阶段8：清洁验收 -->
            <div class="timeline-item" data-id="9">
                <div class="timeline-dot">9</div>
                <div class="timeline-content">
                    <div class="edit-buttons">
                        <button class="edit-btn" onclick="editTimelineItem(9)"><i class="fas fa-edit"></i></button>
                        <button class="delete-btn" onclick="deleteTimelineItem(9)"><i class="fas fa-trash"></i></button>
                    </div>
                    <div class="timeline-title">
                        <h3>清洁验收</h3>
                        <span class="timeline-duration">2-3天</span>
                    </div>
                    <div class="timeline-description">
                        <p>装修完成后的全面清洁和验收，确保所有工程符合要求。</p>
                    </div>
                    <div class="timeline-tips">
                        <div class="collapsible-header">
                            <h4>要点提示</h4>
                            <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
                        </div>
                        <div class="collapsible-content">
                            <ul>
                                <li>彻底清洁所有表面和角落</li>
                                <li>检查各项工程是否有遗漏或瑕疵</li>
                                <li>测试所有电器和设备功能</li>
                                <li>确认水电气是否正常运行</li>
                                <li>完成验收单签字确认</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 阶段9：补漆 -->
            <div class="timeline-item" data-id="10">
                <div class="timeline-dot">10</div>
                <div class="timeline-content">
                    <div class="edit-buttons">
                        <button class="edit-btn" onclick="editTimelineItem(10)"><i class="fas fa-edit"></i></button>
                        <button class="delete-btn" onclick="deleteTimelineItem(10)"><i class="fas fa-trash"></i></button>
                    </div>
                    <div class="timeline-title">
                        <h3>补漆工作</h3>
                        <span class="timeline-duration">1天</span>
                    </div>
                    <div class="timeline-description">
                        <p>在清洁验收后，对发现的漆面划痕、碰伤、漆面不均等问题进行修复和补漆处理。</p>
                    </div>
                    <div class="timeline-tips">
                        <div class="collapsible-header">
                            <h4>要点提示</h4>
                            <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
                        </div>
                        <div class="collapsible-content">
                            <ul>
                                <li>使用与原漆面相同的漆料进行补漆</li>
                                <li>补漆后确保足够的干燥时间</li>
                                <li>补漆完成后再次进行局部清洁</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 阶段10：软装配饰 -->
            <div class="timeline-item" data-id="11">
                <div class="timeline-dot">11</div>
                <div class="timeline-content">
                    <div class="edit-buttons">
                        <button class="edit-btn" onclick="editTimelineItem(11)"><i class="fas fa-edit"></i></button>
                        <button class="delete-btn" onclick="deleteTimelineItem(11)"><i class="fas fa-trash"></i></button>
                    </div>
                    <div class="timeline-title">
                        <h3>家电、软装配饰</h3>
                        <span class="timeline-duration">1-4周</span>
                    </div>
                    <div class="timeline-description">
                        <p>软装是为居室增添个性和温度的阶段，包括家具、绿植、装饰画、窗帘等的选购和布置。</p>
                    </div>
                    <div class="timeline-tips">
                        <div class="collapsible-header">
                            <h4>要点提示</h4>
                            <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
                        </div>
                        <div class="collapsible-content">
                            <ul>
                                <li>根据整体风格选择协调的软装元素</li>
                                <li>家具尺寸需与空间匹配</li>
                                <li>窗帘安装考虑遮光和隐私需求</li>
                                <li>合理搭配色彩和材质</li>
                                <li>适当留白，避免过度装饰</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="intro" style="margin-bottom: 50px;">
            <h2>总工期预估</h2>
            <p>一般情况下，老房全面翻新的总工期约为<strong>2-3个月</strong>。具体时间取决于房屋面积、改造程度（如吊顶、背景墙等造型）、天气（雨季、地下室墙面不容易干透）、施工队伍规模等因素。建议在计划时预留一定的缓冲时间，以应对可能的延误。</p>
            <p>合理的时间规划和施工顺序安排，不仅能提高装修效率，还能确保各个环节的施工质量，最终打造出理想的居住空间。</p>
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <p>老房翻新是一项复杂的工程，建议在专业人士指导下进行。本指南仅供参考，具体施工方案应根据实际情况调整。</p>
            <p>© 2025 家装翻新指南 - 让每一个家都焕发新生</p>
        </div>
    </footer>

    <!-- 编辑模态框 -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle">编辑装修阶段</h2>
            <form id="timelineForm" class="modal-form">
                <input type="hidden" id="timelineItemId">
                <div class="form-group">
                    <label for="title">阶段标题</label>
                    <input type="text" id="title" required>
                </div>
                <div class="form-group">
                    <label for="duration">时间周期</label>
                    <input type="text" id="duration" required>
                </div>
                <div class="form-group">
                    <label for="description">阶段描述</label>
                    <textarea id="description" required></textarea>
                </div>
                <div class="form-group">
                    <label for="tips">要点提示</label>
                    <textarea id="tips" required></textarea>
                </div>
                <div class="form-buttons">
                    <button type="button" class="cancel-btn" onclick="closeModal()">取消</button>
                    <button type="button" class="save-btn" onclick="saveTimelineItem()">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- JavaScript 代码 -->
    <script>
        // 全局变量存储当前最大ID
        let maxTimelineId = 11;

        // 初始化可折叠组件
        function initCollapsible() {
            const headers = document.querySelectorAll('.collapsible-header');
            headers.forEach(header => {
                header.addEventListener('click', function() {
                    const parent = this.closest('.timeline-tips');
                    parent.classList.toggle('active');
                });
            });
        }

        // 页面加载完成后初始化可折叠组件
        document.addEventListener('DOMContentLoaded', function() {
            initCollapsible();
        });

        // 打开添加新阶段的模态框
        function openAddModal() {
            document.getElementById('modalTitle').textContent = '添加新装修阶段';
            document.getElementById('timelineItemId').value = '';
            document.getElementById('title').value = '';
            document.getElementById('duration').value = '';
            document.getElementById('description').value = '';
            document.getElementById('tips').value = '';
            document.getElementById('editModal').style.display = 'block';
        }

        // 打开编辑阶段的模态框
        function editTimelineItem(id) {
            const timelineItem = document.querySelector(`.timeline-item[data-id="${id}"]`);
            if (!timelineItem) return;

            const title = timelineItem.querySelector('.timeline-title h3').textContent;
            const duration = timelineItem.querySelector('.timeline-duration').textContent;
            const description = timelineItem.querySelector('.timeline-description p').textContent;

            // 获取提示列表的HTML内容而不是纯文本
            const tipsContainer = timelineItem.querySelector('.timeline-tips .collapsible-content ul');
            const tipsHtml = tipsContainer ? tipsContainer.innerHTML : '';

            document.getElementById('modalTitle').textContent = '编辑装修阶段';
            document.getElementById('timelineItemId').value = id;
            document.getElementById('title').value = title;
            document.getElementById('duration').value = duration;
            document.getElementById('description').value = description;
            
            // 使用隐藏字段存储原始HTML
            if (!document.getElementById('tipsHtml')) {
                const hiddenField = document.createElement('input');
                hiddenField.type = 'hidden';
                hiddenField.id = 'tipsHtml';
                document.getElementById('timelineForm').appendChild(hiddenField);
            }
            document.getElementById('tipsHtml').value = tipsHtml;
            
            // 为了编辑方便，将HTML转换为带缩进的文本形式
            let tipsText = '';
            const extractListItems = (items, level = 0) => {
                const indent = '    '.repeat(level);
                items.forEach(item => {
                    // 获取当前li的直接文本内容（不包括子元素的文本）
                    let itemText = item.childNodes[0].nodeType === 3 ? item.childNodes[0].textContent.trim() : '';
                    // 如果li包含其他内联元素但不是ul，也要获取其文本
                    for (let i = 0; i < item.childNodes.length; i++) {
                        const node = item.childNodes[i];
                        if (node.nodeType === 1 && node.tagName !== 'UL') {
                            itemText += node.outerHTML;
                        } else if (node.nodeType === 3) {
                            itemText += node.textContent;
                        }
                    }
                    tipsText += indent + '• ' + itemText.trim() + '\n';
                    
                    // 处理嵌套列表
                    const nestedList = item.querySelector('ul');
                    if (nestedList) {
                        const nestedItems = Array.from(nestedList.querySelectorAll('li'));
                        extractListItems(nestedItems, level + 1);
                    }
                });
            };
            
            const topLevelItems = Array.from(tipsContainer.querySelectorAll(':scope > li'));
            extractListItems(topLevelItems);
            
            document.getElementById('tips').value = tipsText;
            document.getElementById('editModal').style.display = 'block';
        }

        // 关闭模态框
        function closeModal() {
            document.getElementById('editModal').style.display = 'none';
        }

        // 保存装修阶段
        function saveTimelineItem() {
            const id = document.getElementById('timelineItemId').value;
            const title = document.getElementById('title').value;
            const duration = document.getElementById('duration').value;
            const description = document.getElementById('description').value;
            const tips = document.getElementById('tips').value;
            const originalTipsHtml = document.getElementById('tipsHtml')?.value || '';

            if (!title || !duration || !description || !tips) {
                alert('请填写所有必填字段');
                return;
            }

            // 检查提示文本是否被修改
            let tipsHtml = originalTipsHtml;
            const formattedTips = document.getElementById('tips').value.trim();
            
            // 如果文本被修改，解析缩进格式并转换为HTML
            if (formattedTips) {
                // 检查文本是否被修改
                if (originalTipsHtml) {
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = originalTipsHtml;
                    let originalText = '';
                    const extractOriginalText = (items, level = 0) => {
                        const indent = '    '.repeat(level);
                        items.forEach(item => {
                            let itemText = '';
                            for (let i = 0; i < item.childNodes.length; i++) {
                                const node = item.childNodes[i];
                                if (node.nodeType === 1 && node.tagName !== 'UL') {
                                    itemText += node.outerHTML || node.textContent;
                                } else if (node.nodeType === 3) {
                                    itemText += node.textContent;
                                }
                            }
                            originalText += indent + '• ' + itemText.trim() + '\n';
                            
                            const nestedList = item.querySelector('ul');
                            if (nestedList) {
                                const nestedItems = Array.from(nestedList.querySelectorAll('li'));
                                extractOriginalText(nestedItems, level + 1);
                            }
                        });
                    };
                    
                    const topLevelItems = Array.from(tempDiv.querySelectorAll(':scope > li'));
                    extractOriginalText(topLevelItems);
                    
                    // 如果文本被修改，解析缩进格式并转换为HTML
                    if (formattedTips !== originalText.trim()) {
                        tipsHtml = parseIndentedListToHtml(formattedTips);
                    }
                } else {
                    tipsHtml = parseIndentedListToHtml(formattedTips);
                }
            }

            // 如果是编辑现有项
            if (id) {
                const timelineItem = document.querySelector(`.timeline-item[data-id="${id}"]`);
                if (timelineItem) {
                    timelineItem.querySelector('.timeline-title h3').textContent = title;
                    timelineItem.querySelector('.timeline-duration').textContent = duration;
                    timelineItem.querySelector('.timeline-description p').textContent = description;
                    timelineItem.querySelector('.timeline-tips .collapsible-content ul').innerHTML = tipsHtml;
                }
            } else {
                // 添加新项
                maxTimelineId++;
                const newId = maxTimelineId;
                const timelineHtml = `
                <div class="timeline-item" data-id="${newId}">
                    <div class="timeline-dot">${newId}</div>
                    <div class="timeline-content">
                        <div class="edit-buttons">
                            <button class="edit-btn" onclick="editTimelineItem(${newId})"><i class="fas fa-edit"></i></button>
                            <button class="delete-btn" onclick="deleteTimelineItem(${newId})"><i class="fas fa-trash"></i></button>
                        </div>
                        <div class="timeline-title">
                            <h3>${title}</h3>
                            <span class="timeline-duration">${duration}</span>
                        </div>
                        <div class="timeline-description">
                            <p>${description}</p>
                        </div>
                        <div class="timeline-tips">
                            <div class="collapsible-header">
                                <h4>要点提示</h4>
                                <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
                            </div>
                            <div class="collapsible-content">
                                <ul>${tipsHtml}</ul>
                            </div>
                        </div>
                    </div>
                </div>`;

                const timeline = document.querySelector('.timeline');
                timeline.insertAdjacentHTML('beforeend', timelineHtml);
                
                // 为新添加的可折叠项绑定事件
                initCollapsible();
            }

            closeModal();
        }

        // 将缩进格式的文本解析为HTML列表
        function parseIndentedListToHtml(text) {
            const lines = text.split('\n').filter(line => line.trim());
            if (lines.length === 0) return '';
            
            // 解析缩进和项目符号
            const parsedLines = lines.map(line => {
                const indentMatch = line.match(/^(\s*)/);
                const indent = indentMatch ? indentMatch[1].length : 0;
                const trimmedLine = line.trim();
                // 移除项目符号（如•、-、*等）
                const content = trimmedLine.replace(/^[•\-*]\s*/, '');
                return { indent, content };
            });
            
            // 构建嵌套列表结构
            let result = '<li>';
            let currentIndent = parsedLines[0].indent;
            let indentStack = [currentIndent];
            
            for (let i = 0; i < parsedLines.length; i++) {
                const { indent, content } = parsedLines[i];
                
                if (i === 0) {
                    // 第一行
                    result += content;
                } else {
                    if (indent > currentIndent) {
                        // 缩进增加，创建子列表
                        result += '<ul><li>' + content;
                        indentStack.push(indent);
                    } else if (indent < currentIndent) {
                        // 缩进减少，关闭子列表
                        while (indentStack[indentStack.length - 1] > indent) {
                            result += '</li></ul>';
                            indentStack.pop();
                        }
                        result += '</li><li>' + content;
                    } else {
                        // 同级缩进
                        result += '</li><li>' + content;
                    }
                }
                
                currentIndent = indent;
            }
            
            // 关闭所有剩余的标签
            result += '</li>';
            for (let i = 1; i < indentStack.length; i++) {
                result += '</ul></li>';
            }
            
            return result;
        }

        // 删除装修阶段
        function deleteTimelineItem(id) {
            if (confirm('确定要删除这个装修阶段吗？')) {
                const timelineItem = document.querySelector(`.timeline-item[data-id="${id}"]`);
                if (timelineItem) {
                    timelineItem.remove();
                }
            }
        }

        // 导出为PDF
        function exportToPDF() {
            // 显示所有折叠内容以确保PDF中包含完整内容
            const collapsibleItems = document.querySelectorAll('.timeline-tips');
            collapsibleItems.forEach(item => {
                item.classList.add('active');
            });

            // 创建一个简化版本的页面用于导出
            const printContent = document.createElement('div');
            printContent.innerHTML = `
                <div style="padding: 20px; font-family: Arial, sans-serif;">
                    <h1 style="text-align: center; color: #4a6da7;">老房翻新全流程指南</h1>
                    <p style="text-align: center; color: #666; margin-bottom: 30px;">从砸墙到软装，一站式掌握家装翻新的每一个环节和时间规划</p>

                    <div style="background-color: white; padding: 20px; border-radius: 8px; margin-bottom: 30px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                        <h2>老房翻新：让旧居焕发新生</h2>
                        <p>老房翻新是一项系统工程，需要合理规划各个环节，把握施工顺序和工期安排。本指南将为您详细介绍从前期准备到最终软装的全过程，帮助您高效、顺利地完成家装翻新。</p>
                    </div>
                </div>
            `;

            // 添加时间线项目
            const timelineContainer = document.createElement('div');
            timelineContainer.style.padding = '0 20px';

            // 获取所有时间线项目
            const timelineItems = document.querySelectorAll('.timeline-item');
            timelineItems.forEach((item, index) => {
                // 获取阶段标题
                const title = item.querySelector('.timeline-title h3').textContent;
                // 获取时间周期
                const duration = item.querySelector('.timeline-duration').textContent;
                // 获取描述
                const description = item.querySelector('.timeline-description p').textContent;

                // 获取提示点
                const tipsList = item.querySelectorAll('.timeline-tips .collapsible-content ul li');
                let tipsHtml = '';
                tipsList.forEach(tip => {
                    tipsHtml += `<li style="margin-bottom: 5px;">${tip.textContent}</li>`;
                });

                // 创建项目 HTML
                const itemHtml = `
                    <div style="background-color: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); page-break-inside: avoid;">
                        <h3 style="color: #4a6da7; margin-top: 0;">阶段 ${index + 1}: ${title}</h3>
                        <div style="display: inline-block; background-color: #e67e22; color: white; padding: 3px 10px; border-radius: 15px; font-size: 14px; margin-bottom: 15px;">${duration}</div>
                        <p style="margin-bottom: 15px;">${description}</p>
                        <div style="background-color: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #e67e22;">
                            <h4 style="color: #e67e22; margin-top: 0; margin-bottom: 10px;">要点提示</h4>
                            <ul style="padding-left: 20px;">
                                ${tipsHtml}
                            </ul>
                        </div>
                    </div>
                `;

                timelineContainer.innerHTML += itemHtml;
            });

            printContent.children[0].appendChild(timelineContainer);

            // 添加总工期预估
            const totalEstimateHtml = `
                <div style="background-color: white; padding: 20px; border-radius: 8px; margin: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                    <h2>总工期预估</h2>
                    <p>一般情况下，老房全面翻新的总工期约为<strong>2-3个月</strong>。具体时间取决于房屋面积、改造程度、施工队伍规模等因素。建议在计划时预留一定的缓冲时间，以应对可能的延误。</p>
                    <p>合理的时间规划和施工顺序安排，不仅能提高装修效率，还能确保各个环节的施工质量，最终打造出理想的居住空间。</p>
                </div>
            `;

            printContent.children[0].innerHTML += totalEstimateHtml;

            // 添加页脚
            const footerHtml = `
                <div style="text-align: center; margin-top: 30px; padding: 15px; border-top: 1px solid #eee; color: #666; font-size: 12px;">
                    <p>老房翻新是一项复杂的工程，建议在专业人士指导下进行。本指南仅供参考，具体施工方案应根据实际情况调整。</p>
                    <p>© ${new Date().getFullYear()} 家装翻新指南 - 让每一个家都焕发新生</p>
                </div>
            `;

            printContent.children[0].innerHTML += footerHtml;

            // 将内容添加到文档中，但不显示
            printContent.style.position = 'absolute';
            printContent.style.left = '-9999px';
            document.body.appendChild(printContent);

            // 设置导出选项
            const opt = {
                margin: 10,
                filename: '装修流程表.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            // 使用html2pdf库导出
            html2pdf()
                .from(printContent.children[0])
                .set(opt)
                .save()
                .then(() => {
                    // 导出完成后移除临时元素
                    document.body.removeChild(printContent);
                    alert('导出成功！');
                })
                .catch(err => {
                    console.error('导出PDF时出错:', err);
                    alert('导出失败，请查看控制台了解详情。');
                    document.body.removeChild(printContent);
                });
        }
    </script>
</body>
</html>
